#!/bin/bash
project_root="$(cd `dirname ${BASH_SOURCE[0]}`; cd ..; pwd)"

usage="
package-extension [-h]
  -h - help
packages the extension
"
while getopts ":h" opt; do
    case $opt in
        h) echo "$usage"; exit;;
    esac
done

chrome_path=
mac_chrome_path="/Applications/Google Chrome.app/Contents/MacOS/Google Chrome"
if [[ -e "$mac_chrome_path" ]]; then
    chrome_path="$mac_chrome_path"
fi
if [[ -z "$chrome_path" ]]; then
    echo "Enter your chrome path and press [ENTER]:"
    read chrome_path
fi

if ! [[ -e "$chrome_path" ]]; then
    echo "Path \"$chrome_path\" doesn't exist. Exiting" >&2
    exit 1
fi

if ! [[ -e "$project_root/s3/groupme-chrome.pem" ]]; then
    echo "No pem file at \"$project_root/s3/groupme-chrome.pem\". Exiting" >&2
    exit 1
fi

cd "$project_root"
"$chrome_path" --pack-extension="$project_root/extension" --pack-extension-key="$project_root/s3/groupme-chrome.pem"
mv "extension.crx" "$project_root/s3/groupme-chrome.crx"
